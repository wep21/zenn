---
title: "ROS 2ã®composable nodeã‚’å«ã‚€launchã‚’Pythonã‹ã‚‰XMLã«ç½®ãæ›ãˆã‚‹(Humble)"
emoji: "ğŸ˜€"
type: "tech"
topics: [ROS2]
published: true
published_at: 2022-11-27 04:35
---
ã“ã®è¨˜äº‹ã§ã¯ROS 2 Humbleã‹ã‚‰ä½¿ãˆã‚‹launch xmlã®è¨˜è¿°æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# ROS 2ã«ãŠã‘ã‚‹launchã®å½¢å¼
ROS 2ã§ä½¿ãˆã‚‹launchã®å½¢å¼ã¯Python, XML, YAMLã®ï¼“ã¤ãŒã‚ã‚Šã¾ã™ã€‚
ãŸã ã—ã™ã¹ã¦åŒã˜æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã‚ã‘ã§ã¯ãªãã€ã™ã¹ã¦ã®æ©Ÿèƒ½ã¯Pythonã§å®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€
expose_action/expose_substitutionã®ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒä»˜ä¸ã•ã‚Œã¦ã‚‹ã‚‚ã®ãŒã€
XML/YAMLã§tag/keyã¨ã—ã¦ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

Galacticã¾ã§ã¯ã€composable nodeã®loadã‚„containerã®èµ·å‹•ã‚’ã™ã‚‹ã«ã¯ã€
å†—é•·ãªPythonã®launchã‚’æ›¸ãå¿…è¦ãŒã‚ã£ãŸã®ã§ã™ãŒã€Humbleã‹ã‚‰ã¯
XMLã§è¨˜è¿°ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚(ç§ã®åŒåƒšã®@kenji-miyake ã•ã‚“ãŒå®Ÿè£…ã—ã¦ãã‚Œã¾ã—ãŸã€‚)

# Pythonã§ã®è¨˜è¿°æ–¹æ³•
ã¾ãšã¯å¾“æ¥ã®Pythonã§ã®è¨˜è¿°æ–¹æ³•ã‹ã‚‰è¦‹ã¦ã„ãã¾ã™ã€‚
```
from launch import LaunchDescription
from launch_ros.actions import LoadComposableNodes, ComposableNodeContainer
from launch_ros.descriptions import ComposableNode

def generate_launch_description():
    container = ComposableNodeContainer(
        name="my_container",
        package="rclcpp_components",
        executable="component_container",
        namespace="",
        arguments="test_args",
        composable_node_descriptions=[
            ComposableNode(
                package="demo_nodes_cpp",
                plugin="demo_nodes_cpp::ParameterBlackboard",
                name="board1",
                parameters=[
                    {"test": "aaa"}
                ],
                extra_arguments=[{"use_intra_process_comms": True}],
            ),
        ],
        output="screen",
    )

    load_composable_nodes = LoadComposableNodes(
        target_container="my_container",
        composable_node_descriptions=[
            ComposableNode(
                package="demo_nodes_cpp",
                plugin="demo_nodes_cpp::ParameterBlackboard",
                name="board2",
                namespace="test_namespace",
                parameters=[
                    {"test": "aaa"}
                ],
                extra_arguments=[{"use_intra_process_comms": True}],
            ),
        ],
    )

    return LaunchDescription([
        container,
        load_composable_nodes,
    ])
```
`ComposableNodeContainer`ãŒcomposable nodeã‚’loadã™ã‚‹ãŸã‚ã®containerã§ã™ã€‚
`composable_node_descriptions`ã«loadã™ã‚‹composable nodeã‚’è¨˜è¿°ã—ã¾ã™ã€‚
ã¾ãŸã™ã§ã«containerãŒèµ·å‹•ã—ã¦ã„ã‚‹å ´åˆã¯ã€`LoadComposableNodes`ã§`target_container`ã«composable nodeã‚’loadã—ãŸã„containerã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€`composable_node_descriptions`ã«è¨˜è¿°ã—ãŸnodeç¾¤ã‚’loadã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

# XMLã§ã®è¨˜è¿°æ–¹æ³•
ä¸Šè¨˜ã®Pythonã§è¨˜è¿°ã•ã‚ŒãŸlaunchã‚’XMLã§ç½®ãæ›ãˆãŸã‚‚ã®ãŒä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚
```
<launch>
  <node_container pkg="rclcpp_components" exec="component_container" name="my_container" namespace="" args="test_args">
    <composable_node pkg="demo_nodes_cpp" plugin="demo_nodes_cpp::ParameterBlackboard" name="board1" namespace="test_namespace">
      <param name="test" value="aaa" />
      <extra_arg name="use_intra_process_comms" value="true" />
    </composable_node>
  </node_container>

  <load_composable_node target="my_container">
    <composable_node pkg="demo_nodes_cpp" plugin="demo_nodes_cpp::ParameterBlackboard" name="board2" namespace="test_namespace">
      <param name="test" value="aaa" />
      <extra_arg name="use_intra_process_comms" value="true" />
    </composable_node>
  </load_composable_node>
</launch>
```
Pythonã®classã¨XMLã®tagã®å¯¾å¿œé–¢ä¿‚ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

- `ComposableNodeContainer` &rarr; `node_container` ([exposeã®å®Ÿè£…](https://github.com/ros2/launch_ros/blob/f142fd335eaa19a54a449b38c929d3cd37075c63/launch_ros/launch_ros/actions/composable_node_container.py#L32-L33))
- `ComposableNode` &rarr; `composable_node`
- `LoadComposableNodes` &rarr; `load_composable_node` ([exposeã®å®Ÿè£…](https://github.com/ros2/launch_ros/blob/f142fd335eaa19a54a449b38c929d3cd37075c63/launch_ros/launch_ros/actions/load_composable_nodes.py#L54-L55))

(`composable_node`ã®ã¿`node_container`/`load_composable_node`ã®ä¸‹ã®`composable_node` entityã‚’èª­ã¿ã«ã„ãã¨ã„ã†å®Ÿè£…ã ã£ãŸãŸã‚ã€exposeã®è¨˜è¿°ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚[å®Ÿè£…ç®‡æ‰€](https://github.com/ros2/launch_ros/blob/f142fd335eaa19a54a449b38c929d3cd37075c63/launch_ros/launch_ros/actions/composable_node_container.py#L63-L64))

ã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°é‡ãŒæ¸›ã‚Šã€ã ã„ã¶ã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸã€‚

